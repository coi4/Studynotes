数据库系统概论

## 1、绪论

### 1.1、四个基本概念

- 数据：描述事物的符号记录
- 数据库：数据库数据**具有永久存储**、**有组织**和**可共享**的三个基本特点
  - 数据库是长期存在计算机内、有组织、可共享的大量数据的集合。数据库中的数据按一定的数据模型组织，描述和储存，**具有较小的冗余度、较高的数据独立性和易扩展性**，并可为各种用户共享。
- 数据库管理系统：是位于用户和操作系统之间的一层**数据管理软件**；和操作系统一样是计算机的基础软件——数据由数据库管理系统统一管理和控制
  - 主要功能：
    1. 数据定义功能
    2. 数据组织、存储和管理
    3. 数据操纵功能
    4. 数据库的事务管理和运行管理
    5. 数据库的建立和维护功能
    6. 其他功能（通信功能，数据转换功能，互访和互操作功能等）
- 数据库系统：由数据库、数据库管理系统（及其应用开发工具）、应用程序和数据库管理员（DBA）组成的存储、管理、处理和维护数据的系统![image-20231115103837746](https://gitee.com/coi4/test/raw/master/img/image-20231115103837746.png)

### 1.2、发展阶段

人工管理系统——文件系统——数据库管理系统（以**加工**数据的程序为中心转向围绕**共享**的数据库为中心的新阶段）

> - 独立性：
>   - 物理独立性：用户的应用程序与数据库中数据的物理存储是相互独立的
>   - 逻辑独立性：用户的应用程序与数据库的逻辑结构是相互独立的

数据模型：人们首先将现实世界抽象为信息世界，然后将信息世界转换为机器世界

- 概念模型：也称为信息模型，按用户观点来对数据和信息建模，主要用于数据库设计

  > - 实体：客观存在并可相互区别的事物。人
  > - 属性：实体所具有的某一特性。人的鼻子嘴巴
  > - 码：唯一标识实体的属性。学号
  > - 实体型：用实体名及其属性集合来抽象和刻画同类实体。含有鼻子和嘴巴的人
  > - 实体集：同一类型实体的集合。学习
  > - 联系：实体之间的联系通常是指不同实体集之间的联系。实体之间的联系有一对一、一对多和多对多等多种联系；实体内部的联系通常是指实体名属性之间的联系
  > - 概念模型的一种表示方法：实体-联系方法。用E-R图来描述现实世界的概念模型，E-R方法也称为E-R模型（分为实体、属性、关系三个核心部分，实体长方形，属性椭圆形，关系菱形）![image-20231115110104625](https://gitee.com/coi4/test/raw/master/img/image-20231115110104625.png)

- 逻辑模型和物理模型

  - 逻辑模型：按计算机系统的观点对数据建模，主要用于数据库管理系统的实现；包括层次模型、网状模型、关系模型
  - 物理模型：对数据最底层的抽象，描述数据在系统内部的表示方法和存取方法，或在磁盘或磁带上的存储方式和存取方法；面向计算机系统

- 常用的数据模型：层次模型，网状模型，关系模型，面向对象数据模型，对象关系数据模型，半结构化数据模型

  - 层次模型：有且只有一个结点没有双亲结点，这个结点称为根结点；根以外的其他结点只有一个双亲结点![image-20231115111407022](https://gitee.com/coi4/test/raw/master/img/image-20231115111407022.png)

  - 网状模型：允许一个以上的结点无双亲；一个结点可以有多于一个双亲![image-20231115111541175](https://gitee.com/coi4/test/raw/master/img/image-20231115111541175.png)

  - 关系模型：数据表![image-20231115111931586](https://gitee.com/coi4/test/raw/master/img/image-20231115111931586.png)

    ![image-20231115114934569](https://gitee.com/coi4/test/raw/master/img/image-20231115114934569.png)

    > - 关系：一个关系对应通常说的一张表
    > - 元组：表中的一行
    > - 属性：表中的一列
    > - 码：也称码键，表中的某个属性组
    > - 域：是一组具有相同数据模型的值的集合  //？
    > - 分量：元组的一个属性

### 1.3、数据库系统的结构

![image-20231115114313531](https://gitee.com/coi4/test/raw/master/img/image-20231115114313531.png)

- 模式：模式数据库中全体数据的逻辑结构和特征的描述，仅仅涉及**型的描述**，不涉及具体值。某一个具体值称为模式的一个实例；模式相对稳定，实例相对变动
  - 三级模式结构：外模式+模式+内模式
    - 外模式：也称子模式或用户模式，是数据库用户（包括应用程序员和最终用户）能够看见和使用的局部数据的逻辑结构和特征的描述，是数据库用户的数据视图，是与**某一应用有关的数据的逻辑表示**
    - 模式：也称逻辑模式，是数据库中全体数据的逻辑结构和特征的描述，是所有**用户的公共数据视图**
    - 内模式：也称存储模式，一个数据库只有一个内模式。是数据**物理结构和存储方式的描述**，是数据在数据库内部的组织方式
- 二级映像：
  - 外模式/模式映像：**模式改变**时，由数据管理人员对各个外模式/模式映像作相应改变，外模式保持不变（应用程序不必修改），保证数据与程序的物理独立性。
  - 模式/内模式映像：存储结构改变，人员做出相应改变，使模式保持不变（应用程序也不用改变），保证物理独立性
  - 数据和程序之间的独立性使数据的定义和描述可以从应用程序中分离出去，并减少应用程序的维护和修改（数据管理系统管理数据）

### 1.4、数据库系统的组成

- 硬件平台及数据库
- 软件
- 人员

数据库管理人员职责：决定数据库中的信息**内容和结构**、数据库的**存储**结构和存取策略、定义数据的**安全性**要求和**完整性约束**条件、**监控**数据库的使用和运行、数据库的**改进**和重组、重构

总结：4概念（3特点，数据，数据库，数据库管理系统，数据库系统4），发展（3.3模型），4模式，3组成（人6）

## 2、关系型数据库

关系操作：插入、查询、删除、修改（增删查改）

- 查询：**选择**、**投影**、连接、除法、**并**、**差**、交、**笛卡尔积**

关系语言分类：

- 关系代数语言（**重点**）：

  - 关系代数：抽象的查询语言，用对**关系的运算**来**表达查询**

  - 三大要素：运算对象（关系）、运算符和运算结果（关系）![image-20231115115737617](https://gitee.com/coi4/test/raw/master/img/image-20231115115737617.png)

  - 5种基本运算：并，差，笛卡尔乘积，选择（不等于<>)，投影(**只想看**XX）及交，并，差![image-20231115115948342](https://gitee.com/coi4/test/raw/master/img/image-20231115115948342.png)

    ![image-20231115120112730](https://gitee.com/coi4/test/raw/master/img/image-20231115120112730.png)

    ![image-20231115122040703](https://gitee.com/coi4/test/raw/master/img/image-20231115122040703.png)

    ![image-20231115122418710](https://gitee.com/coi4/test/raw/master/img/image-20231115122418710.png)

    Cno：课程号，Sno：学号，SC：有学号，课程号和成绩的表
    
  - 连接：

    ![image-20231120124258833](https://gitee.com/coi4/test/raw/master/img/image-20231120124258833.png)

    - 自然连接：把共同属性进行等值连接![image-20231120124708789](https://gitee.com/coi4/test/raw/master/img/image-20231120124708789.png)
      - 悬浮元组：R在S中不存在公共属性上值相等的元组
    - 外连接：把悬浮元组也保存在结果关系中，填空值
    - 左外连接：只保留关系R中的悬浮元组
    - 右外连接：只保留右边关系S中的悬浮元组![image-20231120125319959](https://gitee.com/coi4/test/raw/master/img/image-20231120125319959.png)

  - 除：保留R中满足S的，而且R中列要去掉S的列![image-20231120130143806](https://gitee.com/coi4/test/raw/master/img/image-20231120130143806.png)

    ![image-20231120130304606](https://gitee.com/coi4/test/raw/master/img/image-20231120130304606.png)

  - 关系完整性

    - 实体完整性
      - 主码唯一且非空
    - 参照完整性
      - 外码要么为空，要么对应另一表的主码
    - 用户定义完整性
      - 表完整

- 关系演算语言（不重要）

- SQL语言（重）

总结：模式，操作，语言分类（代数语言，交并差笛卡尔/选择投影/4连接），3完整性

## 3、SQL语言

### 3.1、上

Structured Query Language，结构化查询语言，在数据库管理系统中查询或对数据库里面的数据进行更改的语言

数据库管理系统：

- 关系型：MySQL、Oracle、PostgreSQL、SQLServer
- 非关系型：redis、mongoDB

> DDL：数据定义语言（定义逻辑结构，包括定义基表，视图和索引。删除表，定义表，修改表）
>
> DQL：数据查询语言（对数据库中各种数据对象进行查询）
>
> DML：数据操纵语言（改变数据库中的数据，包括插入、删除、修改）
>
> DCL：数据控制功能（对表和视图的授权，完整性规则的描述以及事务开始和结束等控制语言）

特点：

- 综合统一（独立完成数据库生命周期的全部活动）
- 面向集合的操作方式
- 高度非过程化（用户只需提出“做什么”，不必指明“怎么做”）
- 以同一种语法结构提供两种使用方式（自含式、嵌入式（嵌入高级语言程序中））
- 语言简洁，易学易用

基本语法：

- 数据类型：![image-20231120162220772](https://gitee.com/coi4/test/raw/master/img/image-20231120162220772.png)

  ![image-20231120162246003](https://gitee.com/coi4/test/raw/master/img/image-20231120162246003.png)

- 模式定义：create schema<模式名>authorization<用户名>

  ```
  //为用户wang定义一个学生-课程模式S-T
  create schema“S-T”authorization wang
  ```

  - 模式定义+视图：create schema <模式名>authorization<用户名>[<表定义子句>|<视图定义子句>|<授权定义子句>]

    ```
    //表定义子句
    create schema“Lern”authorization zhangxu create table user（id int primary key，age int，name varchar（255））；
    ```

- 模式删除：drop schema<>< cascade|restrict>

  - 必定二选一
  - cascade（级联）删除模式的同时也把该模式的所有数据库对象删除
  - restrict（限制）如果该模式下有下属对象，比如表视图 就拒绝这个删除语句的执行

- 表的定义：create table 表名（字段 类型 字段约束，字段名 类型 字段约束）

- 删除：drop table <表名>[restrict|cascade]

  - cascade 如果标有外键，视图，触发器的话，也会强行删除，restrict相反

- 修改：

  ```
  alter table<表名>[add[colume]<新列名><数据类型>[完整性约束]][add<表级完整性约束>]
  ```

  ```
  //向student表增加“入学时间”列，其数据类型为日期型
  alter table Student add s_entrance date；
  ```

  ```
  //将年龄的数据类型由字符型改为整数
  alter table Student alter column sage int；
  ```

- 索引的建立：

  ```
  create [unique][cluster]index<索引名> on <表名>(<列名>[<次序名>][,<列明>[<次序名>]]...)
  ```

  cluster：聚簇索引：物理顺序与索引的逻辑顺序相同。比如买书

  ```
  create unique index Stusno on Student（Sno）
  ```

- 索引修改：alter index <旧索引名>rename to<新索引名>

- 删除：drop index<索引名>

### 3.2、中

查询所有：select *from Student

查询部分：select id，title from edu_course（可看到id，title有哪些）（取名：id as 标志，title as 课程i名字）（as可不用写）（表可取名简写成ec）

结果去重：加上distinct（select distinct title 课程名字 from edu_course)

查询结果加条件：![image-20231120171005375](https://gitee.com/coi4/test/raw/master/img/image-20231120171005375.png)

```
select distinct title from edu_course where price>2;

select 1 in <1,2>  //返回1（在）

select * from edu_course where title like'%速成';//%代替任意多个字符，_代替一个

select * from user where username is null；
```

聚集函数：![image-20231120171928539](https://gitee.com/coi4/test/raw/master/img/image-20231120171928539.png)

默认all，去掉重复+distinct

```
select count（*） from edu_course; 
```

分组查询：croup by，要筛选，用having

```
select teacher_id from edu_course group by teacher_id having teacher_id=1;
```

连接：

```
select *from edu_course ec,edu_course_description ecd where ec.id=ecd.id;
```

自身连接：

```
select * from edu_course,edu_course ec2 where ec1.id=ecd2.id;
```

外连接：

```
select * from edu_course ec ((left)(right)) (outer) join edu_course_description ecd on ec.id=ecd.id;
```

多表查询：

```
select * from edu_course ec ((left)(right)) (outer) join edu_course_description ecd on ec.id=ecd.id ((left)(right)) (outer) join edu_chapter ech on ec.id=ech.id
```

嵌套查询：

```
select * from edu_course ec where teacher_id in(select teacher_id from teache_id from edu_course where teacher_id=10 or teacher_id=2)；
```

带有any all的子查询：![image-20231120175109019](https://gitee.com/coi4/test/raw/master/img/image-20231120175109019.png)

```
select * from edu_course ec where price >any (select price from edu_course where price<10);
```

带有exists 的子查询：not exists （如果后面的子查询没有值返回1，否则返回0）exists相反![image-20231120175538759](https://gitee.com/coi4/test/raw/master/img/image-20231120175538759.png)

集合查询：并

### 3.3、下

数据插入：insert into 表名 [(字段列表)] values(值列表......)

- 标准添加、指定部分添加、不指定字段添加值、批量添加值

数据修改：update 表名 set 字段 1=值1，字段2=值2，字段 n=值n....where 条件

数据删除：delete from 表名 [where 条件]

创建视图：

```
create view<视图名>[(<>[,<>]····)] 
as<子查询>
[with check option]

//with check option 表示对视图进行update、insert、delete操作时要保证更新、插入或删除的行满足视图定义中的谓词条件（即子查询中的条件表达式）
```

> 视图：也被称为虚表，即虚拟的表，是一组数据的逻辑表示，**本质是对应于一条select语句**，结果集被赋予一个名字，即视图名字；本身不包含任何数据，只包含映射到基表的一个查询语句，基表数据发生变化，视图数据也随之变化
>
> 当我们业务需求要查出多张表的数据，这时我们可能会关联多张表查询处理，如果这个查询**sql复杂**的话也影响了查询效率，这个时候可以创建视图。**查询时只需要select *from view即可**

![image-20231120193226897](https://gitee.com/coi4/test/raw/master/img/image-20231120193226897.png)

删除视图：drop view <视图名>[cascade]

查询视图：

```
select Sno,Sage
from Is_Student
where Sage<20
```

 更新视图：![image-20231120193642732](https://gitee.com/coi4/test/raw/master/img/image-20231120193642732.png)

### #总结

数据类型，模式创删，表、索引创删改

查询所有、部分、分组（连接）、多表、嵌套（附条件、去重、简化改名、函数）

数据增删改、视图增删查改

## 4、数据库安全性

自主存取控制方法

1. grant <权限> on table <表名> to <用户>
2. revoke <权限>on table <表名> from <用户>

创建用户

create user <username> with

数据库安全性控制：

1. 用户身份鉴别

   - 静态口令鉴别
   - 动态口令鉴别
   - 生物特征鉴别
   - 智能卡鉴别

2. 存取控制

3. *自主存取控制方法：用户可以自定义和分配其他用户的操作权限

   - 主要存取权限：reference权限代表是否允许创建外键![image-20231120194355505](https://gitee.com/coi4/test/raw/master/img/image-20231120194355505.png)

4. 授权 Grant ：Grant <权限> on 表名[(列明)] to  用户 with grant option（若带with grant option子句，则普通用户授权后，**可把自己的权限授予其他用户**）

   ```
   Grant select on student to user1 with grant option
   ```

   

5. 回收权限 revoke：revoke <权限> on <数据对象> from <数据库用户名> cascade

数据库角色：角色指的是一类人，比如说CEO、总监、普通职员，可以给一类人授权

1. 角色的创建：create role <角色名>
2. 角色授权：grant <权限> on <对象类型> to <角色1>，<角色2>
3. 把角色授权给其他用户或者角色：grant <角色> to 角色或者用户名字 [with admin option]
4. 角色权限的收回：revoke <权限> on <对象名> from 角色名字

视图机制：为不同的用户定义不同的视图，把不需要的数据给隐藏起来，这样用户就不会进行误操作![image-20231120195543323](https://gitee.com/coi4/test/raw/master/img/image-20231120195543323.png)

数据加密：把明文变成密文

审计：把对数据库的所有操作都记录到审计日志中

```
对修改SC数据的操作进行审计
audit update on SC

取消对SC表的一切审计
noaudit update on SC
```

## 5、数据库完整性

正确性（符合现实世界的描述）、相容性（同一对象在不同表里面是符合逻辑的，一致）、维护完整性（完整性**约束**条件机制，完整性**检查**方法，**违约处理**）

三大完整性：

- 实体完整性：主码唯一且非空
- 参照完整性：外码要么没有要么唯一
- 用户定义完整性：非空（not null）、列值唯一（unique）、满足某一条件表达式 check来写（check（sex in（''男,'女'))![image-20231120200755849](https://gitee.com/coi4/test/raw/master/img/image-20231120200755849.png)

断言：create assertion <断言句><check子句>（与where类似）![image-20231120200915361](https://gitee.com/coi4/test/raw/master/img/image-20231120200915361.png)

- 删除断言名称：drop assertion 断言名字

触发器：事件->条件->动作 规则;当对一个表增删改时候，对触发器里面的条件进行检查，如果成立，就执行触发器里面的动作，否则不执行里面的动作

- ```
  creat trigger <名>
  {befor|after}事件on表明
  referencing 
      new|old row|table as 变量
  for each{row|statement}
  [where事件]动作体
  ```

![image-20231120201318458](https://gitee.com/coi4/test/raw/master/img/image-20231120201318458.png)

![image-20231120201421259](https://gitee.com/coi4/test/raw/master/img/image-20231120201421259.png)

![image-20231120201510238](https://gitee.com/coi4/test/raw/master/img/image-20231120201510238.png)

删除触发器：drop trigger <触发器名> on <表名>

## 6、关系数据理论

范式原因：

- 数据冗余
- 更新、插入、删除异常

范式分类：不同的规范要求被称为不同的范式（越高的范式数据库冗余越小）

- 1NF（第一范式）、2NF、3NF、BCNF（巴斯-科德范式）、4NF、5NF（完美范式）
- 一般只需3NF

依赖：

- 非平凡的函数依赖![image-20240508114945385](https://gitee.com/coi4/test/raw/master/img/image-20240508114945385.png)

- 平凡![image-20240508115001901](https://gitee.com/coi4/test/raw/master/img/image-20240508115001901.png)

- 完全函数依赖![image-20240508115324390](https://gitee.com/coi4/test/raw/master/img/image-20240508115324390.png)

- 部分函数依赖![image-20240508115340080](https://gitee.com/coi4/test/raw/master/img/image-20240508115340080.png)

  ![image-20240508115307742](https://gitee.com/coi4/test/raw/master/img/image-20240508115307742.png)

候选码：可以推出所有属性

- 选：只出现在左边的一定是，只在右一定不是；左右都不出一定是；再求确定的候选码的闭包，如果可以推出全部，则是，否则， 要把每一个可能的值放进当前确定的候选码里面进行求闭包![image-20240508115942766](https://gitee.com/coi4/test/raw/master/img/image-20240508115942766.png)

## 7、数据库设计

## 8、数据库编程

## 9、关系查询和查询优化

## 10、数据库恢复技术

## 11、并发控制

